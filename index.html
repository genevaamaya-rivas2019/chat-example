<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" const="text/html;charset=UTF-8" />
  <link href="http://fonts.googleapis.com/css?family=Comfortaa" rel="stylesheet" type="text/css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
  <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
  <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">
  <title>Simple Chat App</title>
</head>

<body><br><br><br><br>
  <table class="table">
    <tr>
      <td class="col-4"></td>
      <td class="col-4">
        <div class="card">
          <center>
          <header>
            <h1>Let's Chat</h1>
          </header>

          <section>
            <div id="change_username" class="form-group">
              <input id="username" type="text" class="form-input" /><br>
              <button id="btnUsername" class="btn" type="button">Change username</button>
            </div>
          </section><br><br>

          <section id="input_zone">
            <input id="message" class="vertical-align form-input" type="text" /><br>
            <button id="btnMessage" class="vertical-align btn" type="button">Send</button><br><br>
          </section>
        </center>
        </div>
      </td>
      <td class="col-4">
          <div class="card">
              <center>
              <header>
                <h1>Inbox</h1>
              </header>

              <section id="inbox">
                <section id="feedback"></section>
              </section>
     
            </center>
            </div>
      </td>
    </tr>
  </table>

  <script src="http://code.jquery.com/jquery-latest.min.js"></script>

  <script>
    $(function () {
      var socket = io.connect('http://localhost:3000')

      var message = $("#message")
      var username = $("#username")
      var btnMessage = $("#btnMessage")
      var btnUsername = $("#btnUsername")
      var inbox = $("#inbox")
      var feedback = $("#feedback")

      //Emit message
      btnMessage.click(function () {
        socket.emit('new_message', { message: message.val() })
      })

      //Listen on new_message
      socket.on("new_message", (data) => {
        feedback.html('');
        message.val('');
        inbox.append("<p class='message'>" + data.username + ": " + data.message + "</p>")
      })

      //Emit a username
      btnUsername.click(function () {
        socket.emit('change_username', { username: username.val() })
      })

      //Emit typing
      message.bind("keypress", () => {
        socket.emit('typing')
      })

      //Listen on typing
      socket.on('typing', (data) => {
        feedback.html("<p><i>" + data.username + " is typing a message..." + "</i></p>")
      })
    });
  </script>
</body>

</html>