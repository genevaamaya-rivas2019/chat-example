<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" const="text/html;charset=UTF-8" />
  <link href="http://fonts.googleapis.com/css?family=Comfortaa" rel="stylesheet" type="text/css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
  <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
  <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">
  <title>Simple Chat App</title>
</head>

<body><br><br><br><br>
  <center>
    <header>
      <h1>Let's Chat</h1>
    </header>
  </center>

  <center>
    <div class="modal active" id="modal-id">
      <a href="#close" class="modal-overlay" aria-label="Close"></a>
      <div class="modal-container">
        <div class="modal-header">
          <a href="#close" class="btn btn-clear float-right" aria-label="Close"></a>
          <div class="modal-title h5">Enter Username</div>
        </div>
        <div class="modal-body">
          <div class="content">
            <div id="change_username" class="form-group">
              <input id="username" type="text" class="form-input" /><br>
              <button id="btnUsername" class="btn" type="button">Set username</button>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          ...
        </div>
      </div>
    </div>
  </center>
  <table class="table">
    <tr>

      <td class="col-4">
        <div class="card">
          <!-- <center>
            <section id="input_zone">
              <input id="message" class="vertical-align form-input" type="text" /><br>
              <button id="btnMessage" class="vertical-align btn" type="button">Send</button><br><br>
            </section>
          </center> -->
        </div>
      </td>
      <td class="col-4">
        <div class="card">
          <center>
            <header>
              <h2>Inbox</h2>
            </header>

            <section id="inbox">
              <section id="feedback"></section>
            </section>

          </center>

        </div><br><br><br><br>
        <div class="card">
          <div class="inpMessage">
            <center>
              <section id="input_zone">
                <input id="message" class="vertical-align form-input" type="text" /><br>
                <button id="btnMessage" class="vertical-align btn" type="button">Send</button><br><br>
              </section>
            </center>
          </div>
        </div>
      </td>
      <td class="col-4">
        <div class="card">
          <center>
            <header>
              <h2>Active Users</h2>
            </header>
          </center>
        </div>
      </td>
    </tr>
  </table>

  <script src="http://code.jquery.com/jquery-latest.min.js"></script>

  <script>
    $(document).ready(function () {
      var socket = io.connect('http://localhost:3000')

      var message = $("#message")
      var username = $("#username")
      var btnMessage = $("#btnMessage")
      var btnUsername = $("#btnUsername")
      var inbox = $("#inbox")
      var feedback = $("#feedback")

      //close modal
      $(document).delegate('#btnUsername', 'click', function (e) {
        $(this).closest('.modal').removeClass('active');
        e.preventDefault();
      });

      //Emit message
      btnMessage.click(function () {
        socket.emit('new_message', { message: message.val() })
      })

      //Listen on new_message
      socket.on("new_message", (data) => {
        feedback.html('');
        message.val('');
        inbox.append("<p class='message'>" + data.username + ": " + data.message + "</p>")
      })

      //Emit a username
      btnUsername.click(function () {
        socket.emit('change_username', { username: username.val() })
      })

      //Emit typing
      message.bind("keypress", () => {
        socket.emit('typing')
      })

      //Listen on typing
      socket.on('typing', (data) => {
        feedback.html("<p><i>" + data.username + " is typing a message..." + "</i></p>")
      })
    });
  </script>
</body>

</html>